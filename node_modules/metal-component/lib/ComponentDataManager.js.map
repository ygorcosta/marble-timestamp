{"version":3,"sources":["../src/ComponentDataManager.js"],"names":["BLACKLIST","components","context","element","refs","state","stateKey","wasRendered","DATA_MANAGER_DATA","ComponentDataManager","component","data","getInitialConfig","setKeysBlacklist","configState","mixin","getStateStatic","constructor","getManagerData","state_","dispose","name","get","getStateKeys","getState","keys","i","length","key","getStateKeyConfig","internal","hasOwnProperty","set","setDefaultValue","callback","setState","createState_"],"mappings":"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","file":"ComponentDataManager.js","sourcesContent":["'use strict';\n\nimport {isDef, object} from 'metal';\nimport State from 'metal-state';\n\nconst BLACKLIST = {\n\tcomponents: true,\n\tcontext: true,\n\telement: true,\n\trefs: true,\n\tstate: true,\n\tstateKey: true,\n\twasRendered: true,\n};\nconst DATA_MANAGER_DATA = '__DATA_MANAGER_DATA__';\n\n/**\n * Class to handle Component Data\n */\nclass ComponentDataManager {\n\t/**\n\t * Creates the `State` instance that will handle the main component data.\n\t * @param {!Component} component\n\t * @param {!Object} data\n\t * @protected\n\t */\n\tcreateState_(component, data) {\n\t\tconst state = new State(\n\t\t\tcomponent.getInitialConfig(),\n\t\t\tcomponent,\n\t\t\tcomponent\n\t\t); // eslint-disable-line\n\t\tstate.setKeysBlacklist(BLACKLIST);\n\t\tstate.configState(\n\t\t\tobject.mixin({}, data, State.getStateStatic(component.constructor))\n\t\t);\n\t\tthis.getManagerData(component).state_ = state;\n\t}\n\n\t/**\n\t * Disposes of any data being used by the manager in this component.\n\t * @param {!Component} component\n\t */\n\tdispose(component) {\n\t\tconst data = this.getManagerData(component);\n\t\tif (data.state_) {\n\t\t\tdata.state_.dispose();\n\t\t}\n\t\tcomponent[DATA_MANAGER_DATA] = null;\n\t}\n\n\t/**\n\t * Gets the data with the given name.\n\t * @param {!Component} component\n\t * @param {string} name\n\t * @return {*}\n\t */\n\tget(component, name) {\n\t\treturn this.getManagerData(component).state_.get(name);\n\t}\n\n\t/**\n\t * Gets the manager data for the given component.\n\t * @param {!Component} component\n\t * @return {Object}\n\t */\n\tgetManagerData(component) {\n\t\treturn component[DATA_MANAGER_DATA];\n\t}\n\n\t/**\n\t * Gets the keys for state data that can be synced via `sync` functions.\n\t * @param {!Component} component\n\t * @return {!Array<string>}\n\t */\n\tgetSyncKeys(component) {\n\t\treturn this.getManagerData(component).state_.getStateKeys();\n\t}\n\n\t/**\n\t * Gets the keys for state data.\n\t * @param {!Component} component\n\t * @return {!Array<string>}\n\t */\n\tgetStateKeys(component) {\n\t\treturn this.getManagerData(component).state_.getStateKeys();\n\t}\n\n\t/**\n\t * Gets the whole state data.\n\t * @param {!Component} component\n\t * @return {!Object}\n\t */\n\tgetState(component) {\n\t\treturn this.getManagerData(component).state_.getState();\n\t}\n\n\t/**\n\t * Gets the `State` instance being used.\n\t * @param {!Component} component\n\t * @return {!Object}\n\t */\n\tgetStateInstance(component) {\n\t\treturn this.getManagerData(component).state_;\n\t}\n\n\t/**\n\t * Updates all non internal data with the given values (or to the default\n\t * value if none is given).\n\t * @param {!Component} component\n\t * @param {!Object} data\n\t * @param {State=} state\n\t */\n\treplaceNonInternal(\n\t\tcomponent,\n\t\tdata,\n\t\tstate = this.getManagerData(component).state_\n\t) {\n\t\tconst keys = state.getStateKeys();\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst key = keys[i];\n\t\t\tif (!state.getStateKeyConfig(key).internal) {\n\t\t\t\tif (data.hasOwnProperty(key) && isDef(data[key])) {\n\t\t\t\t\tstate.set(key, data[key]);\n\t\t\t\t} else {\n\t\t\t\t\tstate.setDefaultValue(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the value of all the specified state keys.\n\t * @param {!Component} component\n\t * @param {!Object.<string,*>} state A map of state keys to the values they\n\t *   should be set to.\n\t * @param {function()=} callback An optional function that will be run\n\t *   after the next batched update is triggered.\n\t */\n\tsetState(component, state, callback) {\n\t\tthis.getManagerData(component).state_.setState(state, callback);\n\t}\n\n\t/**\n\t * Sets up the specified component's data.\n\t * @param {!Component} component\n\t * @param {!Object} data\n\t */\n\tsetUp(component, data) {\n\t\tcomponent[DATA_MANAGER_DATA] = {};\n\t\tthis.createState_(component, data);\n\t}\n}\n\nexport default new ComponentDataManager();\n"]}